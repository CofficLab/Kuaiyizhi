---
title: 在 Astro 项目中实现国际化（i18n）
description: 本实验将详细记录如何按照 Astro 官方文档在项目中实现多语言支持
---

# 在 Astro 项目中实现国际化（i18n）

## 实验目的

1. 理解 Astro 项目中实现国际化的基本原理
2. 掌握使用官方推荐方案实现多语言支持的具体步骤
3. 学习如何组织和管理多语言内容

## 实验环境

- Node.js: v18.0.0 或更高版本
- Astro: v4.0.0 或更高版本
- 操作系统：跨平台支持

## 实验步骤

### 步骤一：项目准备

1. 创建新的 Astro 项目（如果是现有项目可跳过）：
```bash
npm create astro@latest my-i18n-site
cd my-i18n-site
```

2. 创建基本的目录结构：
```
src/
├── pages/
│   ├── en/
│   │   └── index.astro
│   ├── zh/
│   │   └── index.astro
│   └── index.astro
└── i18n/
    └── ui.ts
```

### 步骤二：配置路由策略

1. 在 `astro.config.mjs` 中配置 i18n：

```javascript
import { defineConfig } from 'astro/config';

export default defineConfig({
  i18n: {
    defaultLocale: 'zh',
    locales: ['en', 'zh'],
    routing: {
      prefixDefaultLocale: false
    }
  }
});
```

### 步骤三：创建语言配置文件

1. 在 `src/i18n/ui.ts` 中定义翻译内容：

```typescript
export const languages = {
  en: 'English',
  zh: '中文',
};

export const defaultLang = 'zh';

export const ui = {
  en: {
    'nav.home': 'Home',
    'nav.about': 'About',
    'nav.blog': 'Blog',
  },
  zh: {
    'nav.home': '首页',
    'nav.about': '关于',
    'nav.blog': '博客',
  },
} as const;
```

### 步骤四：创建语言工具函数

1. 在 `src/i18n/utils.ts` 中创建辅助函数：

```typescript
import { ui, defaultLang } from './ui';

export function getLangFromUrl(url: URL) {
  const [, lang] = url.pathname.split('/');
  if (lang in ui) return lang as keyof typeof ui;
  return defaultLang;
}

export function useTranslations(lang: keyof typeof ui) {
  return function t(key: keyof typeof ui[typeof defaultLang]) {
    return ui[lang][key] || ui[defaultLang][key];
  }
}
```

### 步骤五：实现语言切换组件

1. 创建 `src/components/LanguagePicker.astro`：

```astro
---
import { languages } from '../i18n/ui';
---

<ul>
  {Object.entries(languages).map(([lang, label]) => (
    <li>
      <a href={`/${lang}/`}>{label}</a>
    </li>
  ))}
</ul>

<style>
  ul {
    display: flex;
    gap: 1rem;
    list-style: none;
    padding: 0;
  }
  a {
    color: #666;
    text-decoration: none;
  }
  a:hover {
    color: #000;
    text-decoration: underline;
  }
</style>
```

### 步骤六：创建多语言页面

1. 创建中文首页 `src/pages/zh/index.astro`：

```astro
---
import { useTranslations } from '../../i18n/utils';
import LanguagePicker from '../../components/LanguagePicker.astro';

const t = useTranslations('zh');
---

<html lang="zh">
  <head>
    <title>我的多语言网站</title>
  </head>
  <body>
    <nav>
      <LanguagePicker />
      <a href="/">{t('nav.home')}</a>
      <a href="/about">{t('nav.about')}</a>
      <a href="/blog">{t('nav.blog')}</a>
    </nav>
    <h1>欢迎访问中文站点</h1>
  </body>
</html>
```

2. 创建英文首页 `src/pages/en/index.astro`：

```astro
---
import { useTranslations } from '../../i18n/utils';
import LanguagePicker from '../../components/LanguagePicker.astro';

const t = useTranslations('en');
---

<html lang="en">
  <head>
    <title>My Multilingual Website</title>
  </head>
  <body>
    <nav>
      <LanguagePicker />
      <a href="/en">{t('nav.home')}</a>
      <a href="/en/about">{t('nav.about')}</a>
      <a href="/en/blog">{t('nav.blog')}</a>
    </nav>
    <h1>Welcome to English Site</h1>
  </body>
</html>
```

## 实验结果

完成上述步骤后，我们成功实现了：

1. 基于路由的语言切换机制
2. 可复用的翻译系统
3. 语言切换组件
4. 多语言页面结构

访问以下 URL 可以看到不同语言版本：
- http://localhost:4321/ （默认中文）
- http://localhost:4321/en/ （英文）
- http://localhost:4321/zh/ （中文）

## 实验总结

### 优点
1. 官方支持的解决方案，维护性好
2. 基于文件系统的路由，结构清晰
3. TypeScript 支持，类型安全
4. 灵活的翻译管理系统

### 注意事项
1. 需要手动维护每个语言版本的路由
2. 翻译文件需要统一管理和及时更新
3. URL 结构需要考虑 SEO 友好性

### 改进建议
1. 可以添加自动重定向功能
2. 考虑引入翻译管理工具
3. 实现语言偏好记忆功能

## 参考资料

1. [Astro 官方国际化文档](https://docs.astro.build/en/guides/internationalization/)
2. [Astro Routing 文档](https://docs.astro.build/en/guides/routing/)
3. [TypeScript 文档](https://www.typescriptlang.org/docs/) 