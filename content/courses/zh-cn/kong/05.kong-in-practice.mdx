---
title: "å®æˆ˜æ¼”ç»ƒ"
---

# ç¬¬äº”ç« ï¼šå®æˆ˜æ¼”ç»ƒ ğŸ’ª

ç†è®ºçŸ¥è¯†å·²ç»æŒæ¡äº†ä¸å°‘ï¼Œç°åœ¨æ˜¯æ—¶å€™å°†è¿™äº›çŸ¥è¯†åº”ç”¨åˆ°å®é™…åœºæ™¯ä¸­äº†ã€‚æœ¬ç« å°†é€šè¿‡ä¸‰ä¸ªå®Œæ•´çš„æ¡ˆä¾‹ï¼Œå±•ç¤ºKongåœ¨ä¸åŒç¯å¢ƒä¸‹çš„åº”ç”¨ï¼Œå¹¶åˆ†äº«ä¸€äº›å¸¸è§çš„"å‘"åŠå…¶è§£å†³æ–¹æ³•ã€‚

## æ¡ˆä¾‹1ï¼šæ„å»ºä¸€ä¸ªå®Œæ•´çš„APIç½‘å…³æ¶æ„

åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ„å»ºä¸€ä¸ªå®Œæ•´çš„APIç½‘å…³æ¶æ„ï¼ŒåŒ…æ‹¬è®¤è¯ã€é™æµã€æ—¥å¿—å’Œç›‘æ§ç­‰åŠŸèƒ½ã€‚

### éœ€æ±‚åˆ†æ

å‡è®¾æˆ‘ä»¬æ­£åœ¨ä¸ºä¸€ä¸ªç”µå­å•†åŠ¡å¹³å°æ„å»ºAPIç½‘å…³ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š

1. å¯¹å¤–æš´éœ²ç»Ÿä¸€çš„APIå…¥å£
2. å¯¹ä¸åŒAPIå®æ–½ä¸åŒçš„è®¤è¯ç­–ç•¥
3. å¯¹é«˜é¢‘APIè¿›è¡Œé™æµä¿æŠ¤
4. è®°å½•æ‰€æœ‰APIè°ƒç”¨æ—¥å¿—
5. ç›‘æ§APIæ€§èƒ½å’Œä½¿ç”¨æƒ…å†µ

### æ¶æ„è®¾è®¡

```
å®¢æˆ·ç«¯ â†’ Kong APIç½‘å…³ â†’ å¾®æœåŠ¡é›†ç¾¤
                     â†“
                  ç›‘æ§ç³»ç»Ÿ
                     â†“
                  æ—¥å¿—ç³»ç»Ÿ
```

### å®æ–½æ­¥éª¤

#### 1. å®‰è£…å’Œé…ç½®Kong

ä½¿ç”¨Docker Composeå¿«é€Ÿéƒ¨ç½²Kongå’ŒPostgreSQLï¼š

```yaml
# docker-compose.yml
version: '3'

services:
  kong-database:
    image: postgres:13
    environment:
      POSTGRES_USER: kong
      POSTGRES_DB: kong
      POSTGRES_PASSWORD: kongpass
    volumes:
      - kong_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD", "pg_isready", "-U", "kong"]
      interval: 5s
      timeout: 5s
      retries: 5

  kong-migration:
    image: kong:latest
    depends_on:
      - kong-database
    environment:
      KONG_DATABASE: postgres
      KONG_PG_HOST: kong-database
      KONG_PG_USER: kong
      KONG_PG_PASSWORD: kongpass
    command: kong migrations bootstrap

  kong:
    image: kong:latest
    depends_on:
      - kong-database
      - kong-migration
    environment:
      KONG_DATABASE: postgres
      KONG_PG_HOST: kong-database
      KONG_PG_USER: kong
      KONG_PG_PASSWORD: kongpass
      KONG_PROXY_ACCESS_LOG: /dev/stdout
      KONG_ADMIN_ACCESS_LOG: /dev/stdout
      KONG_PROXY_ERROR_LOG: /dev/stderr
      KONG_ADMIN_ERROR_LOG: /dev/stderr
      KONG_ADMIN_LISTEN: 0.0.0.0:8001
    ports:
      - "8000:8000"
      - "8001:8001"
      - "8443:8443"
      - "8444:8444"

volumes:
  kong_data:
```

å¯åŠ¨æœåŠ¡ï¼š

```bash
docker-compose up -d
```

#### 2. é…ç½®æœåŠ¡å’Œè·¯ç”±

å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹å¾®æœåŠ¡ï¼š

- äº§å“æœåŠ¡ï¼š`http://product-service:8080`
- è®¢å•æœåŠ¡ï¼š`http://order-service:8080`
- ç”¨æˆ·æœåŠ¡ï¼š`http://user-service:8080`

åˆ›å»ºæœåŠ¡ï¼š

```bash
# äº§å“æœåŠ¡
curl -X POST http://localhost:8001/services \
  --data "name=product-service" \
  --data "url=http://product-service:8080"

# è®¢å•æœåŠ¡
curl -X POST http://localhost:8001/services \
  --data "name=order-service" \
  --data "url=http://order-service:8080"

# ç”¨æˆ·æœåŠ¡
curl -X POST http://localhost:8001/services \
  --data "name=user-service" \
  --data "url=http://user-service:8080"
```

åˆ›å»ºè·¯ç”±ï¼š

```bash
# äº§å“è·¯ç”±
curl -X POST http://localhost:8001/services/product-service/routes \
  --data "name=product-route" \
  --data "paths[]=/api/products"

# è®¢å•è·¯ç”±
curl -X POST http://localhost:8001/services/order-service/routes \
  --data "name=order-route" \
  --data "paths[]=/api/orders"

# ç”¨æˆ·è·¯ç”±
curl -X POST http://localhost:8001/services/user-service/routes \
  --data "name=user-route" \
  --data "paths[]=/api/users"
```

#### 3. é…ç½®è®¤è¯

å¯¹äº§å“APIä½¿ç”¨APIå¯†é’¥è®¤è¯ï¼š

```bash
# å¯ç”¨key-authæ’ä»¶
curl -X POST http://localhost:8001/services/product-service/plugins \
  --data "name=key-auth" \
  --data "config.key_names=apikey"

# åˆ›å»ºæ¶ˆè´¹è€…
curl -X POST http://localhost:8001/consumers \
  --data "username=mobile-app"

# ä¸ºæ¶ˆè´¹è€…åˆ›å»ºAPIå¯†é’¥
curl -X POST http://localhost:8001/consumers/mobile-app/key-auth \
  --data "key=MOBILE-APP-KEY"
```

å¯¹è®¢å•APIä½¿ç”¨JWTè®¤è¯ï¼š

```bash
# å¯ç”¨JWTæ’ä»¶
curl -X POST http://localhost:8001/services/order-service/plugins \
  --data "name=jwt"

# ä¸ºæ¶ˆè´¹è€…åˆ›å»ºJWTå‡­è¯
curl -X POST http://localhost:8001/consumers/mobile-app/jwt \
  --data "algorithm=HS256" \
  --data "secret=jwt_secret"
```

å¯¹ç”¨æˆ·APIä½¿ç”¨OAuth2è®¤è¯ï¼š

```bash
# å¯ç”¨OAuth2æ’ä»¶
curl -X POST http://localhost:8001/services/user-service/plugins \
  --data "name=oauth2" \
  --data "config.scopes=email,profile" \
  --data "config.mandatory_scope=true" \
  --data "config.enable_authorization_code=true"

# åˆ›å»ºOAuthåº”ç”¨
curl -X POST http://localhost:8001/consumers/mobile-app/oauth2 \
  --data "name=Mobile App" \
  --data "client_id=MOBILE-CLIENT-ID" \
  --data "client_secret=MOBILE-CLIENT-SECRET" \
  --data "redirect_uris=https://example.com/callback"
```

#### 4. é…ç½®é™æµ

å¯¹äº§å“APIè¿›è¡Œé™æµï¼š

```bash
curl -X POST http://localhost:8001/services/product-service/plugins \
  --data "name=rate-limiting" \
  --data "config.second=10" \
  --data "config.minute=100" \
  --data "config.hour=1000" \
  --data "config.policy=local"
```

#### 5. é…ç½®æ—¥å¿—

å¯ç”¨HTTPæ—¥å¿—æ’ä»¶ï¼Œå°†æ—¥å¿—å‘é€åˆ°ELKå †æ ˆï¼š

```bash
curl -X POST http://localhost:8001/plugins \
  --data "name=http-log" \
  --data "config.http_endpoint=http://logstash:8080" \
  --data "config.method=POST" \
  --data "config.timeout=10000" \
  --data "config.keepalive=60000"
```

#### 6. é…ç½®ç›‘æ§

å¯ç”¨Prometheusæ’ä»¶ï¼š

```bash
curl -X POST http://localhost:8001/plugins \
  --data "name=prometheus"
```

ç„¶åé…ç½®PrometheusæŠ“å–Kongçš„æŒ‡æ ‡ï¼Œå¹¶ä½¿ç”¨Grafanaåˆ›å»ºä»ªè¡¨æ¿ã€‚

### æµ‹è¯•å’ŒéªŒè¯

ä½¿ç”¨curlæµ‹è¯•å„ä¸ªAPIï¼š

```bash
# æµ‹è¯•äº§å“APIï¼ˆéœ€è¦APIå¯†é’¥ï¼‰
curl -i http://localhost:8000/api/products \
  -H "apikey: MOBILE-APP-KEY"

# æµ‹è¯•è®¢å•APIï¼ˆéœ€è¦JWTï¼‰
curl -i http://localhost:8000/api/orders \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

# æµ‹è¯•ç”¨æˆ·APIï¼ˆéœ€è¦OAuth2ä»¤ç‰Œï¼‰
curl -i http://localhost:8000/api/users \
  -H "Authorization: Bearer ACCESS_TOKEN"
```

## æ¡ˆä¾‹2ï¼šå¾®æœåŠ¡æ¶æ„ä¸­çš„Kongæœ€ä½³å®è·µ

åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åœ¨å¾®æœåŠ¡æ¶æ„ä¸­æœ€ä½³åœ°ä½¿ç”¨Kongï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡å’Œç†”æ–­é™çº§ã€‚

### éœ€æ±‚åˆ†æ

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ï¼Œéœ€è¦ï¼š

1. è‡ªåŠ¨å‘ç°å’Œæ³¨å†ŒæœåŠ¡
2. åœ¨å¤šä¸ªæœåŠ¡å®ä¾‹é—´è¿›è¡Œè´Ÿè½½å‡è¡¡
3. å®ç°ç†”æ–­å’Œé™çº§ï¼Œé˜²æ­¢çº§è”æ•…éšœ
4. æ”¯æŒè“ç»¿éƒ¨ç½²å’Œé‡‘ä¸é›€å‘å¸ƒ

### æ¶æ„è®¾è®¡

```
                    â”Œâ”€ æœåŠ¡A (v1) â”€â”
                    â”‚              â”‚
å®¢æˆ·ç«¯ â†’ Kong â†’ æœåŠ¡å‘ç° â”€ æœåŠ¡B (v1) â”€ æ•°æ®åº“
                    â”‚              â”‚
                    â””â”€ æœåŠ¡B (v2) â”€â”˜
```

### å®æ–½æ­¥éª¤

#### 1. é›†æˆæœåŠ¡å‘ç°

æˆ‘ä»¬å°†ä½¿ç”¨Consulä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼Œå¹¶ä¸Kongé›†æˆï¼š

```bash
# å®‰è£…Consulæ’ä»¶
curl -X POST http://localhost:8001/plugins \
  --data "name=consul" \
  --data "config.host=consul" \
  --data "config.port=8500" \
  --data "config.register_service=true" \
  --data "config.token=CONSUL_TOKEN"
```

#### 2. é…ç½®ä¸Šæ¸¸å’Œè´Ÿè½½å‡è¡¡

åˆ›å»ºä¸Šæ¸¸æœåŠ¡ï¼š

```bash
# åˆ›å»ºæœåŠ¡Açš„ä¸Šæ¸¸
curl -X POST http://localhost:8001/upstreams \
  --data "name=service-a-upstream"

# æ·»åŠ æœåŠ¡Açš„å®ä¾‹
curl -X POST http://localhost:8001/upstreams/service-a-upstream/targets \
  --data "target=service-a-1:8080" \
  --data "weight=100"

curl -X POST http://localhost:8001/upstreams/service-a-upstream/targets \
  --data "target=service-a-2:8080" \
  --data "weight=100"

# åˆ›å»ºæœåŠ¡å¹¶æŒ‡å‘ä¸Šæ¸¸
curl -X POST http://localhost:8001/services \
  --data "name=service-a" \
  --data "host=service-a-upstream"
```

é…ç½®å¥åº·æ£€æŸ¥ï¼š

```bash
curl -X PATCH http://localhost:8001/upstreams/service-a-upstream \
  --data "healthchecks.active.healthy.interval=5" \
  --data "healthchecks.active.healthy.successes=2" \
  --data "healthchecks.active.unhealthy.interval=5" \
  --data "healthchecks.active.unhealthy.http_failures=2" \
  --data "healthchecks.active.type=http" \
  --data "healthchecks.active.http_path=/health"
```

#### 3. å®ç°ç†”æ–­å’Œé™çº§

ä½¿ç”¨ç¤¾åŒºæ’ä»¶circuit-breakerå®ç°ç†”æ–­ï¼š

```bash
curl -X POST http://localhost:8001/services/service-a/plugins \
  --data "name=circuit-breaker" \
  --data "config.error_threshold=50" \
  --data "config.window_size=10" \
  --data "config.min_calls=5"
```

é…ç½®é™çº§å“åº”ï¼š

```bash
curl -X POST http://localhost:8001/services/service-a/plugins \
  --data "name=request-termination" \
  --data "config.status_code=503" \
  --data "config.message={\"error\":\"æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•\"}" \
  --data "config.content_type=application/json" \
  --data "config.trigger=circuit-open"
```

#### 4. å®ç°è“ç»¿éƒ¨ç½²

ä½¿ç”¨è·¯ç”±å’Œæ ‡ç­¾å®ç°è“ç»¿éƒ¨ç½²ï¼š

```bash
# åˆ›å»ºè“è‰²ç‰ˆæœ¬çš„æœåŠ¡
curl -X POST http://localhost:8001/services \
  --data "name=service-b-blue" \
  --data "url=http://service-b-v1:8080" \
  --data "tags=blue"

# åˆ›å»ºç»¿è‰²ç‰ˆæœ¬çš„æœåŠ¡
curl -X POST http://localhost:8001/services \
  --data "name=service-b-green" \
  --data "url=http://service-b-v2:8080" \
  --data "tags=green"

# åˆå§‹è·¯ç”±æŒ‡å‘è“è‰²ç‰ˆæœ¬
curl -X POST http://localhost:8001/services/service-b-blue/routes \
  --data "name=service-b-route" \
  --data "paths[]=/api/service-b"
```

åˆ‡æ¢åˆ°ç»¿è‰²ç‰ˆæœ¬ï¼š

```bash
# æ›´æ–°è·¯ç”±æŒ‡å‘ç»¿è‰²ç‰ˆæœ¬
curl -X PATCH http://localhost:8001/routes/service-b-route \
  --data "service.id=$(curl -s http://localhost:8001/services/service-b-green | jq -r '.id')"
```

#### 5. å®ç°é‡‘ä¸é›€å‘å¸ƒ

ä½¿ç”¨è¯·æ±‚è½¬æ¢å’Œè·¯ç”±ä¼˜å…ˆçº§å®ç°é‡‘ä¸é›€å‘å¸ƒï¼š

```bash
# åˆ›å»ºé‡‘ä¸é›€è·¯ç”±ï¼ˆ10%æµé‡ï¼‰
curl -X POST http://localhost:8001/services/service-b-green/routes \
  --data "name=service-b-canary" \
  --data "paths[]=/api/service-b" \
  --data "priority=200"

# æ·»åŠ è¯·æ±‚è½¬æ¢æ’ä»¶ï¼Œåªæœ‰10%çš„è¯·æ±‚ä¼šè¢«å¤„ç†
curl -X POST http://localhost:8001/routes/service-b-canary/plugins \
  --data "name=request-transformer" \
  --data "config.functions=[\"math.random() <= 0.1\"]"
```

### æµ‹è¯•å’ŒéªŒè¯

ä½¿ç”¨å‹åŠ›æµ‹è¯•å·¥å…·éªŒè¯è´Ÿè½½å‡è¡¡å’Œç†”æ–­åŠŸèƒ½ï¼š

```bash
# ä½¿ç”¨wrkè¿›è¡Œå‹åŠ›æµ‹è¯•
wrk -t10 -c100 -d30s http://localhost:8000/api/service-a

# æ¨¡æ‹ŸæœåŠ¡æ•…éšœï¼ŒéªŒè¯ç†”æ–­
# (åœ¨æœåŠ¡Aä¸­æ³¨å…¥æ•…éšœï¼Œç„¶åè§‚å¯ŸKongçš„å“åº”)
```

## æ¡ˆä¾‹3ï¼šKongä¸K8sçš„å®Œç¾é…åˆ

åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ¢è®¨å¦‚ä½•åœ¨Kubernetesç¯å¢ƒä¸­éƒ¨ç½²å’Œä½¿ç”¨Kongï¼Œå®ç°äº‘åŸç”ŸAPIç®¡ç†ã€‚

### éœ€æ±‚åˆ†æ

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¿è¡Œåœ¨Kubernetesä¸Šçš„å¾®æœåŠ¡åº”ç”¨ï¼Œéœ€è¦ï¼š

1. åœ¨K8sä¸­éƒ¨ç½²Kong
2. ä½¿ç”¨Kubernetes Ingress APIç®¡ç†è·¯ç”±
3. ä½¿ç”¨CRDï¼ˆè‡ªå®šä¹‰èµ„æºå®šä¹‰ï¼‰ç®¡ç†Kongé…ç½®
4. å®ç°è‡ªåŠ¨æ‰©å±•å’Œé«˜å¯ç”¨

### æ¶æ„è®¾è®¡

```
å¤–éƒ¨æµé‡ â†’ Ingress Controller â†’ Kong â†’ K8sæœåŠ¡ â†’ Pod
```

### å®æ–½æ­¥éª¤

#### 1. å®‰è£…Kong Ingress Controller

ä½¿ç”¨Helmå®‰è£…Kong Ingress Controllerï¼š

```bash
# æ·»åŠ Kong Helmä»“åº“
helm repo add kong https://charts.konghq.com
helm repo update

# å®‰è£…Kong Ingress Controller
helm install kong kong/kong \
  --namespace kong \
  --create-namespace \
  --set ingressController.enabled=true \
  --set admin.enabled=true \
  --set admin.http.enabled=true \
  --set proxy.type=LoadBalancer
```

#### 2. åˆ›å»ºKubernetesæœåŠ¡å’Œéƒ¨ç½²

åˆ›å»ºç¤ºä¾‹åº”ç”¨ï¼š

```yaml
# echo-service.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo
  namespace: default
spec:
  replicas: 3
  selector:
    matchLabels:
      app: echo
  template:
    metadata:
      labels:
        app: echo
    spec:
      containers:
      - name: echo
        image: hashicorp/http-echo
        args:
        - "-text=Hello, Kong!"
        ports:
        - containerPort: 5678
---
apiVersion: v1
kind: Service
metadata:
  name: echo
  namespace: default
spec:
  selector:
    app: echo
  ports:
  - port: 80
    targetPort: 5678
```

åº”ç”¨é…ç½®ï¼š

```bash
kubectl apply -f echo-service.yaml
```

#### 3. åˆ›å»ºIngressèµ„æº

ä½¿ç”¨Kubernetes Ingress APIåˆ›å»ºè·¯ç”±ï¼š

```yaml
# echo-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-ingress
  namespace: default
  annotations:
    konghq.com/strip-path: "true"
spec:
  ingressClassName: kong
  rules:
  - http:
      paths:
      - path: /echo
        pathType: Prefix
        backend:
          service:
            name: echo
            port:
              number: 80
```

åº”ç”¨Ingressï¼š

```bash
kubectl apply -f echo-ingress.yaml
```

#### 4. ä½¿ç”¨KongPlugin CRDæ·»åŠ æ’ä»¶

åˆ›å»ºé€Ÿç‡é™åˆ¶æ’ä»¶ï¼š

```yaml
# rate-limiting-plugin.yaml
apiVersion: configuration.konghq.com/v1
kind: KongPlugin
metadata:
  name: rate-limiting
  namespace: default
config:
  minute: 5
  policy: local
plugin: rate-limiting
```

å°†æ’ä»¶åº”ç”¨åˆ°Ingressï¼š

```yaml
# echo-ingress-with-plugin.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: echo-ingress
  namespace: default
  annotations:
    konghq.com/strip-path: "true"
    konghq.com/plugins: rate-limiting
spec:
  ingressClassName: kong
  rules:
  - http:
      paths:
      - path: /echo
        pathType: Prefix
        backend:
          service:
            name: echo
            port:
              number: 80
```

åº”ç”¨æ›´æ–°ï¼š

```bash
kubectl apply -f rate-limiting-plugin.yaml
kubectl apply -f echo-ingress-with-plugin.yaml
```

#### 5. é…ç½®è‡ªåŠ¨æ‰©å±•

ä½¿ç”¨Horizontal Pod Autoscalerè‡ªåŠ¨æ‰©å±•Kongï¼š

```yaml
# kong-hpa.yaml
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: kong-hpa
  namespace: kong
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: kong-kong
  minReplicas: 2
  maxReplicas: 10
  metrics:
  - type: Resource
    resource:
      name: cpu
      target:
        type: Utilization
        averageUtilization: 70
```

åº”ç”¨HPAï¼š

```bash
kubectl apply -f kong-hpa.yaml
```

### æµ‹è¯•å’ŒéªŒè¯

æµ‹è¯•APIè®¿é—®ï¼š

```bash
# è·å–Kongä»£ç†çš„å¤–éƒ¨IP
export PROXY_IP=$(kubectl get svc -n kong kong-kong-proxy -o jsonpath='{.status.loadBalancer.ingress[0].ip}')

# æµ‹è¯•API
curl -i http://$PROXY_IP/echo

# æµ‹è¯•é€Ÿç‡é™åˆ¶
for i in {1..10}; do curl -i http://$PROXY_IP/echo; done
```

## è¸©å‘æŒ‡å—ï¼šé‚£äº›å¹´æˆ‘ä»¬è¸©è¿‡çš„å‘

åœ¨ä½¿ç”¨Kongçš„è¿‡ç¨‹ä¸­ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°å„ç§å„æ ·çš„é—®é¢˜ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„"å‘"åŠå…¶è§£å†³æ–¹æ³•ã€‚

### 1. æ•°æ®åº“è¿æ¥é—®é¢˜

**é—®é¢˜**ï¼šKongæ— æ³•è¿æ¥åˆ°PostgreSQLæ•°æ®åº“ã€‚

**ç—‡çŠ¶**ï¼š
```
[error] failed to connect to PostgreSQL: host=kong-database port=5432 user=kong database=kong: connection refused
```

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®ä¿PostgreSQLæœåŠ¡æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
- éªŒè¯æ•°æ®åº“å‡­è¯æ˜¯å¦æ­£ç¡®
- ä½¿ç”¨`pg_isready`å‘½ä»¤æ£€æŸ¥PostgreSQLæ˜¯å¦å‡†å¤‡å¥½æ¥å—è¿æ¥

### 2. æ’ä»¶é…ç½®é”™è¯¯

**é—®é¢˜**ï¼šæ’ä»¶é…ç½®é”™è¯¯å¯¼è‡´è¯·æ±‚å¤±è´¥ã€‚

**ç—‡çŠ¶**ï¼š
```
[error] [plugin:rate-limiting] config.minute is required
```

**è§£å†³æ–¹æ³•**ï¼š
- ä»”ç»†æ£€æŸ¥æ’ä»¶æ–‡æ¡£ï¼Œç¡®ä¿æ‰€æœ‰å¿…éœ€çš„é…ç½®é¡¹éƒ½å·²æä¾›
- ä½¿ç”¨Kong Admin APIçš„`/schemas/plugins/{plugin-name}`ç«¯ç‚¹æŸ¥çœ‹æ’ä»¶çš„é…ç½®æ¶æ„
- åœ¨åº”ç”¨æ’ä»¶å‰ï¼Œå…ˆæµ‹è¯•é…ç½®æ˜¯å¦æœ‰æ•ˆ

### 3. è·¯ç”±åŒ¹é…é—®é¢˜

**é—®é¢˜**ï¼šè¯·æ±‚æ²¡æœ‰åŒ¹é…åˆ°é¢„æœŸçš„è·¯ç”±ã€‚

**ç—‡çŠ¶**ï¼š
- è¯·æ±‚è¿”å›404é”™è¯¯
- è¯·æ±‚è¢«é”™è¯¯çš„æœåŠ¡å¤„ç†

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥è·¯ç”±çš„`paths`ã€`hosts`å’Œ`methods`é…ç½®
- ä½¿ç”¨Kong Admin APIçš„`/routes`ç«¯ç‚¹æŸ¥çœ‹æ‰€æœ‰è·¯ç”±
- å¯ç”¨Kongçš„è°ƒè¯•æ—¥å¿—ï¼ŒæŸ¥çœ‹è¯·æ±‚åŒ¹é…è¿‡ç¨‹
- æ³¨æ„è·¯ç”±çš„ä¼˜å…ˆçº§ï¼ŒKongä¼šé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„åŒ¹é…è·¯ç”±

### 4. è¯ä¹¦å’ŒSSLé—®é¢˜

**é—®é¢˜**ï¼šHTTPSé…ç½®ä¸æ­£ç¡®ã€‚

**ç—‡çŠ¶**ï¼š
- SSLæ¡æ‰‹å¤±è´¥
- è¯ä¹¦éªŒè¯é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
- ç¡®ä¿è¯ä¹¦å’Œç§é’¥æ ¼å¼æ­£ç¡®
- æ£€æŸ¥è¯ä¹¦é“¾æ˜¯å¦å®Œæ•´
- éªŒè¯è¯ä¹¦çš„åŸŸåæ˜¯å¦ä¸è¯·æ±‚çš„`Host`å¤´åŒ¹é…
- ä½¿ç”¨`openssl`å‘½ä»¤è¡Œå·¥å…·éªŒè¯è¯ä¹¦

### 5. æ€§èƒ½è°ƒä¼˜é—®é¢˜

**é—®é¢˜**ï¼šKongæ€§èƒ½ä¸ä½³ã€‚

**ç—‡çŠ¶**ï¼š
- é«˜å»¶è¿Ÿ
- é«˜CPUä½¿ç”¨ç‡
- è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ³•**ï¼š
- å¢åŠ KongèŠ‚ç‚¹æ•°é‡
- è°ƒæ•´Nginxå·¥ä½œè¿›ç¨‹æ•°ï¼ˆ`nginx_worker_processes`ï¼‰
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆä½¿ç”¨Redisç¼“å­˜ï¼‰
- è€ƒè™‘ä½¿ç”¨DB-lessæ¨¡å¼æé«˜æ€§èƒ½
- ç›‘æ§å¹¶è°ƒæ•´ä¸Šæ¸¸è¿æ¥æ± è®¾ç½®

### 6. æ’ä»¶æ‰§è¡Œé¡ºåºé—®é¢˜

**é—®é¢˜**ï¼šæ’ä»¶æ‰§è¡Œé¡ºåºä¸ç¬¦åˆé¢„æœŸã€‚

**ç—‡çŠ¶**ï¼š
- è®¤è¯æ’ä»¶åœ¨å…¶ä»–æ’ä»¶ä¹‹åæ‰§è¡Œï¼Œå¯¼è‡´æœªæˆæƒè¯·æ±‚è¢«å¤„ç†
- è¯·æ±‚è½¬æ¢æ’ä»¶åœ¨æ—¥å¿—æ’ä»¶ä¹‹åæ‰§è¡Œï¼Œå¯¼è‡´æ—¥å¿—è®°å½•çš„æ˜¯è½¬æ¢å‰çš„è¯·æ±‚

**è§£å†³æ–¹æ³•**ï¼š
- äº†è§£Kongæ’ä»¶çš„ä¼˜å…ˆçº§æœºåˆ¶
- æŸ¥çœ‹æ’ä»¶çš„`PRIORITY`å±æ€§ï¼ˆæ•°å­—è¶Šå¤§ï¼Œä¼˜å…ˆçº§è¶Šä½ï¼‰
- å¦‚æœéœ€è¦ï¼Œå¼€å‘è‡ªå®šä¹‰æ’ä»¶å¹¶è®¾ç½®é€‚å½“çš„ä¼˜å…ˆçº§

### 7. Kubernetesé›†æˆé—®é¢˜

**é—®é¢˜**ï¼šKong Ingress Controllerä¸æ­£å¸¸å·¥ä½œã€‚

**ç—‡çŠ¶**ï¼š
- Ingressèµ„æºæœªè¢«å¤„ç†
- CRDæ— æ³•åº”ç”¨

**è§£å†³æ–¹æ³•**ï¼š
- æ£€æŸ¥Kong Ingress Controllerçš„æ—¥å¿—
- éªŒè¯RBACæƒé™æ˜¯å¦æ­£ç¡®
- ç¡®ä¿ä½¿ç”¨äº†æ­£ç¡®çš„`ingressClassName`
- æ£€æŸ¥CRDæ˜¯å¦å·²æ­£ç¡®å®‰è£…

### 8. å‡çº§ç›¸å…³é—®é¢˜

**é—®é¢˜**ï¼šå‡çº§Kongç‰ˆæœ¬åå‡ºç°é—®é¢˜ã€‚

**ç—‡çŠ¶**ï¼š
- é…ç½®ä¸å…¼å®¹
- æ’ä»¶è¡Œä¸ºå˜åŒ–

**è§£å†³æ–¹æ³•**ï¼š
- æ€»æ˜¯é˜…è¯»å‡çº§æŒ‡å—å’Œå˜æ›´æ—¥å¿—
- åœ¨å‡çº§å‰å¤‡ä»½æ•°æ®åº“
- åœ¨éç”Ÿäº§ç¯å¢ƒä¸­å…ˆæµ‹è¯•å‡çº§
- è€ƒè™‘ä½¿ç”¨è“ç»¿éƒ¨ç½²ç­–ç•¥è¿›è¡Œå‡çº§

## å°ç»“

åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸‰ä¸ªå®é™…æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†Kongåœ¨ä¸åŒåœºæ™¯ä¸‹çš„åº”ç”¨ï¼š

1. æ„å»ºå®Œæ•´çš„APIç½‘å…³æ¶æ„ï¼ŒåŒ…æ‹¬è®¤è¯ã€é™æµã€æ—¥å¿—å’Œç›‘æ§
2. åœ¨å¾®æœåŠ¡æ¶æ„ä¸­åº”ç”¨Kongçš„æœ€ä½³å®è·µï¼ŒåŒ…æ‹¬æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡å’Œç†”æ–­é™çº§
3. åœ¨Kubernetesç¯å¢ƒä¸­éƒ¨ç½²å’Œä½¿ç”¨Kongï¼Œå®ç°äº‘åŸç”ŸAPIç®¡ç†

æˆ‘ä»¬è¿˜åˆ†äº«äº†ä¸€äº›å¸¸è§çš„"å‘"åŠå…¶è§£å†³æ–¹æ³•ï¼Œå¸®åŠ©ä½ åœ¨å®é™…ä½¿ç”¨Kongæ—¶é¿å…è¿™äº›é—®é¢˜ã€‚

åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨Kongçš„æ€§èƒ½è°ƒä¼˜ã€å®‰å…¨é˜²æŠ¤å’Œé«˜çº§ç®¡ç†æŠ€å·§ï¼Œå¸®åŠ©ä½ æˆä¸ºçœŸæ­£çš„Kongå¤§å¸ˆã€‚

---

> æ¸©é¦¨æç¤ºï¼šæœ¬æ•™ç¨‹æ˜¯ç³»åˆ—å†…å®¹çš„ä¸€éƒ¨åˆ†ï¼Œè¯·ç»§ç»­é˜…è¯»ä¸‹ä¸€ç« èŠ‚ï¼Œé€æ­¥æŒæ¡Kongçš„å„é¡¹åŠŸèƒ½ã€‚ 