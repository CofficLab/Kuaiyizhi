---
import DocLayout from '@layouts/DocLayout.astro';
import LessionNotFound from '@components/lession/LessionNotFound.astro';
import LessionDoc from '@/models/LessionDoc';
import { type RenderResult } from 'astro:content';
import type { Heading } from '@/models/Heading';

export interface Props {
  id: string;
}

const { id } = Astro.props;
const lession = await LessionDoc.find(id);
const title = lession?.getTitle() || '没有找到课程';
const description = lession?.getDescription() || '没有找到课程';
const sidebarItem = (await (await lession?.getBook())?.toSidebarItem()) || null;

let headings: Heading[] = [];
let Content: RenderResult['Content'] | null = null;

if (lession) {
  const renderResult = await lession.render();
  headings = renderResult.headings;
  Content = renderResult.Content;
}
---

<DocLayout
  title={title}
  description={description}
  sidebarItem={sidebarItem}
  headings={headings}>
  {Content ? <Content /> : <LessionNotFound id={id} />}
</DocLayout>
