---
import CourseLayout from '@layouts/CourseLayout.astro';
import { getCourseBySlug } from '@database/courses';
import { render } from 'astro:content';

export interface Props {
  slug: string;
  locale: 'zh-cn' | 'en';
  redirectPath: string;
}

const { slug, locale, redirectPath } = Astro.props;

const debug = false;

if (debug) {
  console.log(`ğŸ“‘ CoursePage: Start processing for ${locale}`);
  console.log('ğŸ“‘ CoursePage: slug', slug);
}

const course = await getCourseBySlug(slug, locale);

// å¦‚æœè¯¾ç¨‹ä¸å­˜åœ¨ï¼Œæ˜¾ç¤ºå‹å¥½æç¤º
if (!course) {
  return Astro.redirect(redirectPath, 307);
}

const { Content, headings } = await render(course);
---

<CourseLayout
  courseId={slug}
  title={course.data.title ?? ''}
  description={course.data.description ?? ''}
  headings={headings}>
  <Content />
</CourseLayout>
