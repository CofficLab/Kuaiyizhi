---
import AppLayout from './AppLayout.astro';
import { getMetaIdsAndTitles } from '../database/meta';
import type SidebarItem from '../interface/SidebarItem';
import type { BlogLayoutProps } from '../interface/BlogLayoutProps';
import { logger } from '../utils/logger';

const { title, description, headings = [] } = Astro.props as BlogLayoutProps;
const metaIdsAndTitles = await getMetaIdsAndTitles(Astro.currentLocale ?? 'en');
const sidebarItems: SidebarItem[] = metaIdsAndTitles.map((metaIdAndTitle) => ({
    label: metaIdAndTitle.title,
    link: `/${metaIdAndTitle.id.replace('zh-cn/', '').replace('en/', '')}`,
}));

//logger.array(`sidebarItems`, sidebarItems);
---

<AppLayout
    title={title}
    description={description}
    template="doc"
    frontmatter={{
        title: title,
        description: description,
        template: 'doc',
        draft: true,
    }}
    hasSidebar={true}
    sidebar={sidebarItems}
    headings={headings}>
    <slot />
</AppLayout>
