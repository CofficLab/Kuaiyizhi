---
import AppLayout from './AppLayout.astro';
import { getChapters } from '../database/courses';
import SidebarItem from '../models/SidebarItem';
import { logger } from '../utils/logger';

interface Props {
  title: string;
  courseId: string;
  description: string;
  headings: Array<{ depth: number; slug: string; text: string }>;
}

const debug = true;
const { title, courseId, description, headings = [] } = Astro.props;
const sidebarItems: SidebarItem[] = await getChapters(
  Astro.currentLocale ?? 'en',
  courseId
);

if (debug) {
  logger.info(`courseId: ${courseId}`);
  logger.info(`Astro.currentLocale: ${Astro.currentLocale}`);
  logger.array(`course sidebarItems`, sidebarItems);
}
---

<AppLayout
  title={title}
  description={description}
  template="doc"
  frontmatter={{
    title: title,
    description: description,
    template: 'doc',
  }}
  hasSidebar={true}
  sidebar={sidebarItems}
  headings={headings}
  hidePageTitle={true}>
  <slot />
</AppLayout>
