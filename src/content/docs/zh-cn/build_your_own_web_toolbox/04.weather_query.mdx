---
title: å¤©æ°”æŸ¥è¯¢åŠŸèƒ½å®ç°
description: å®ç°å¤©æ°”æŸ¥è¯¢é¡µé¢ã€å¤©æ°”å¡ç‰‡ç»„ä»¶å’ŒåŸå¸‚æœç´¢åŠŸèƒ½
---

## å¤©æ°”æŸ¥è¯¢åŠŸèƒ½æ¦‚è¿°

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªå®Œæ•´çš„å¤©æ°”æŸ¥è¯¢åŠŸèƒ½ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

1. è®¾è®¡å’Œå®ç°å¤©æ°”æŸ¥è¯¢é¡µé¢
2. åˆ›å»ºå¤©æ°”å¡ç‰‡ç»„ä»¶
3. é›†æˆèšåˆæ•°æ®å¤©æ°” API
4. å®ç°åŸå¸‚æœç´¢åŠŸèƒ½

### å‡†å¤‡å·¥ä½œ

1. æ³¨å†Œèšåˆæ•°æ®è´¦å·å¹¶è·å– API Keyï¼š
   - è®¿é—® [èšåˆæ•°æ®å®˜ç½‘](https://www.juhe.cn/)
   - æ³¨å†Œè´¦å·å¹¶å®åè®¤è¯
   - ç”³è¯·å¤©æ°”é¢„æŠ¥ API
   - è·å– API Key

2. åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

```bash
# .env
JUHE_WEATHER_KEY=your_api_key_here
```

## å¤©æ°”å¡ç‰‡ç»„ä»¶

é¦–å…ˆï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯å¤ç”¨çš„å¤©æ°”å¡ç‰‡ç»„ä»¶ï¼š

```vue
<!-- components/WeatherCard.vue -->
<script setup lang="ts">
import { computed } from 'vue'

// å®šä¹‰ç»„ä»¶å±æ€§
interface Props {
  weather: {
    city: string
    date: string
    temperature: string
    weather: string
    wind: string
    humidity: string
  }
}

const props = defineProps<Props>()

// æ ¹æ®å¤©æ°”çŠ¶å†µé€‰æ‹©å›¾æ ‡
const weatherIcon = computed(() => {
  const weather = props.weather.weather
  if (weather.includes('æ™´')) return 'â˜€ï¸'
  if (weather.includes('å¤šäº‘')) return 'â›…'
  if (weather.includes('é˜´')) return 'â˜ï¸'
  if (weather.includes('é›¨')) return 'ğŸŒ§ï¸'
  if (weather.includes('é›ª')) return 'ğŸŒ¨ï¸'
  return 'ğŸŒ¤ï¸'
})
</script>

<template>
  <div class="card w-96 bg-base-200 shadow-xl">
    <div class="card-body">
      <h2 class="card-title text-2xl">
        {{ weather.city }}
        <span class="text-3xl">{{ weatherIcon }}</span>
      </h2>
      <div class="text-lg space-y-2">
        <p>{{ weather.date }}</p>
        <p>æ¸©åº¦ï¼š{{ weather.temperature }}â„ƒ</p>
        <p>å¤©æ°”ï¼š{{ weather.weather }}</p>
        <p>é£å†µï¼š{{ weather.wind }}</p>
        <p>æ¹¿åº¦ï¼š{{ weather.humidity }}</p>
      </div>
    </div>
  </div>
</template>
```

## å¤©æ°”æŸ¥è¯¢é¡µé¢

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºå¤©æ°”æŸ¥è¯¢é¡µé¢ï¼š

```vue
<!-- pages/weather/index.vue -->
<script setup lang="ts">
import { ref } from 'vue'

// åŸå¸‚æœç´¢
const searchQuery = ref('')
const searchResults = ref<string[]>([])
const selectedCity = ref('')
const loading = ref(false)
const error = ref('')

// å¤©æ°”æ•°æ®
const weatherData = ref<any>(null)

// çƒ­é—¨åŸå¸‚
const popularCities = [
  'åŒ—äº¬',
  'ä¸Šæµ·',
  'å¹¿å·',
  'æ·±åœ³',
  'æ­å·',
  'æˆéƒ½',
  'æ­¦æ±‰',
  'è¥¿å®‰'
]

// æœç´¢åŸå¸‚
async function searchCity() {
  if (!searchQuery.value) return
  
  try {
    loading.value = true
    error.value = ''
    
    // è°ƒç”¨åŸå¸‚æœç´¢ API
    const response = await fetch(`/api/weather/cities?query=${encodeURIComponent(searchQuery.value)}`)
    const data = await response.json()
    
    if (data.error) {
      error.value = data.error
      return
    }
    
    searchResults.value = data.cities
  } catch (e) {
    error.value = 'æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
  } finally {
    loading.value = false
  }
}

// è·å–å¤©æ°”æ•°æ®
async function getWeather(city: string) {
  try {
    loading.value = true
    error.value = ''
    selectedCity.value = city
    searchQuery.value = ''
    searchResults.value = []
    
    // è°ƒç”¨å¤©æ°”æŸ¥è¯¢ API
    const response = await fetch(`/api/weather?city=${encodeURIComponent(city)}`)
    const data = await response.json()
    
    if (data.error) {
      error.value = data.error
      return
    }
    
    weatherData.value = data
  } catch (e) {
    error.value = 'è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
  } finally {
    loading.value = false
  }
}
</script>

<template>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">å¤©æ°”æŸ¥è¯¢</h1>
    
    <!-- æœç´¢æ¡† -->
    <div class="form-control w-full max-w-lg mb-8">
      <div class="input-group">
        <input
          v-model="searchQuery"
          type="text"
          placeholder="è¾“å…¥åŸå¸‚åç§°..."
          class="input input-bordered w-full"
          @input="searchCity"
        />
        <button
          class="btn btn-primary"
          :disabled="loading"
          @click="searchCity"
        >
          æœç´¢
        </button>
      </div>
      
      <!-- æœç´¢ç»“æœ -->
      <ul
        v-if="searchResults.length > 0"
        class="menu bg-base-200 w-full mt-2 rounded-box"
      >
        <li v-for="city in searchResults" :key="city">
          <a @click="getWeather(city)">{{ city }}</a>
        </li>
      </ul>
      
      <!-- é”™è¯¯æç¤º -->
      <div v-if="error" class="alert alert-error mt-4">
        {{ error }}
      </div>
    </div>
    
    <!-- çƒ­é—¨åŸå¸‚ -->
    <div class="mb-8">
      <h2 class="text-xl font-bold mb-4">çƒ­é—¨åŸå¸‚</h2>
      <div class="flex flex-wrap gap-2">
        <button
          v-for="city in popularCities"
          :key="city"
          class="btn btn-outline"
          @click="getWeather(city)"
        >
          {{ city }}
        </button>
      </div>
    </div>
    
    <!-- å¤©æ°”ä¿¡æ¯ -->
    <div v-if="weatherData" class="flex justify-center">
      <WeatherCard :weather="weatherData" />
    </div>
    
    <!-- åŠ è½½çŠ¶æ€ -->
    <div
      v-if="loading"
      class="flex justify-center items-center h-40"
    >
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  </div>
</template>
```

## API è·¯ç”±

åˆ›å»ºå¤©æ°”ç›¸å…³çš„ API è·¯ç”±ï¼š

```typescript
// server/api/weather/index.ts
import { defineEventHandler, getQuery } from 'h3'

export default defineEventHandler(async (event) => {
  try {
    const query = getQuery(event)
    const city = query.city as string
    
    if (!city) {
      return {
        error: 'è¯·æä¾›åŸå¸‚åç§°'
      }
    }
    
    // è°ƒç”¨èšåˆæ•°æ®å¤©æ°” API
    const apiKey = process.env.JUHE_WEATHER_KEY
    const response = await fetch(
      `http://apis.juhe.cn/simpleWeather/query?city=${encodeURIComponent(city)}&key=${apiKey}`
    )
    
    const data = await response.json()
    
    if (data.error_code !== 0) {
      return {
        error: data.reason || 'è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥'
      }
    }
    
    // æ ¼å¼åŒ–è¿”å›æ•°æ®
    const weather = data.result.realtime
    return {
      city,
      date: new Date().toLocaleDateString('zh-CN'),
      temperature: weather.temperature,
      weather: weather.info,
      wind: `${weather.direct} ${weather.power}`,
      humidity: weather.humidity
    }
  } catch (error) {
    console.error('Weather API Error:', error)
    return {
      error: 'æœåŠ¡å™¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•'
    }
  }
})

// server/api/weather/cities.ts
import { defineEventHandler, getQuery } from 'h3'

// åŸå¸‚æ•°æ®ï¼ˆå®é™…é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨æ•°æ®åº“æˆ–å®Œæ•´çš„åŸå¸‚æ•°æ®æ–‡ä»¶ï¼‰
const cities = [
  'åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·', 'å—äº¬', 'æˆéƒ½', 'é‡åº†',
  'æ­¦æ±‰', 'è¥¿å®‰', 'å¤©æ´¥', 'è‹å·', 'é•¿æ²™', 'éƒ‘å·', 'é’å²›', 'å¤§è¿'
]

export default defineEventHandler(async (event) => {
  try {
    const query = getQuery(event)
    const searchQuery = (query.query as string || '').toLowerCase()
    
    if (!searchQuery) {
      return {
        cities: []
      }
    }
    
    // æœç´¢åŒ¹é…çš„åŸå¸‚
    const matchedCities = cities.filter(city =>
      city.toLowerCase().includes(searchQuery)
    )
    
    return {
      cities: matchedCities
    }
  } catch (error) {
    console.error('Cities API Error:', error)
    return {
      error: 'æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
    }
  }
})
```

## ä½¿ç”¨è¯´æ˜

1. ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥è¯¢å¤©æ°”ï¼š
   - åœ¨æœç´¢æ¡†è¾“å…¥åŸå¸‚åç§°
   - ç‚¹å‡»çƒ­é—¨åŸå¸‚åˆ—è¡¨ä¸­çš„åŸå¸‚
   - ä»æœç´¢ç»“æœä¸­é€‰æ‹©åŸå¸‚

2. å¤©æ°”ä¿¡æ¯å±•ç¤ºï¼š
   - åŸå¸‚åç§°
   - å¤©æ°”å›¾æ ‡
   - å½“å‰æ—¥æœŸ
   - å®æ—¶æ¸©åº¦
   - å¤©æ°”çŠ¶å†µ
   - é£å‘å’Œé£åŠ›
   - ç©ºæ°”æ¹¿åº¦

## ä¼˜åŒ–å»ºè®®

1. æ•°æ®ç¼“å­˜
   - ä½¿ç”¨ Redis æˆ–æµè§ˆå™¨ç¼“å­˜å­˜å‚¨å¤©æ°”æ•°æ®
   - è®¾ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´

2. é”™è¯¯å¤„ç†
   - æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æç¤º
   - å®ç°è¯·æ±‚é‡è¯•æœºåˆ¶

3. ç”¨æˆ·ä½“éªŒ
   - æ·»åŠ å®šä½åŠŸèƒ½ï¼Œè‡ªåŠ¨è·å–å½“å‰åŸå¸‚
   - æ”¯æŒæ”¶è—å¸¸ç”¨åŸå¸‚
   - æ·»åŠ å¤©æ°”é¢„æŠ¥åŠŸèƒ½

4. æ€§èƒ½ä¼˜åŒ–
   - ä½¿ç”¨é˜²æŠ–å¤„ç†æœç´¢è¾“å…¥
   - ä¼˜åŒ–åŸå¸‚æ•°æ®çš„å­˜å‚¨å’ŒæŸ¥è¯¢
   - å®ç°ç»„ä»¶æ‡’åŠ è½½

## ä¸‹ä¸€æ­¥

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ï¼š

1. å®ç°å¿«é€’æŸ¥è¯¢åŠŸèƒ½
2. è®¾è®¡å¿«é€’æŸ¥è¯¢é¡µé¢
3. é›†æˆå¿«é€’æŸ¥è¯¢ API
4. æ·»åŠ æŸ¥è¯¢å†å²è®°å½•åŠŸèƒ½