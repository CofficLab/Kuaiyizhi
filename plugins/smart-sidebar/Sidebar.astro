---
import type { Props } from '@astrojs/starlight/props';
import DefaultSidebar from '@astrojs/starlight/components/Sidebar.astro';
const emoji = 'ðŸš€';

// èŽ·å–å½“å‰é¡µé¢è·¯å¾„çš„ç¬¬ä¸€éƒ¨åˆ†ä½œä¸ºåˆ†ç±»
const currentPath = Astro.url.pathname;
const category = currentPath.split('/').slice(0, 3).join('/'); // èŽ·å–å‰3çº§è·¯å¾„ (å¦‚ 'zh/astro/docs')

// console.log(`${emoji} Smart Sidebar: path: ${currentPath}`);
// console.log(`${emoji} Smart Sidebar: category: ${category}`);

// è¿‡æ»¤ä¾§è¾¹æ é¡¹ç›®ï¼Œåªä¿ç•™ä¸Žå½“å‰åˆ†ç±»ç›¸å…³çš„é¡¹ç›®
const filteredSidebar = Astro.props.sidebar
  .filter((group) => group.type === 'group')
  .map((group) => ({
    ...group,
    entries: group.entries.filter((entry) => {
      if (entry.type === 'link') {
        return entry.href.startsWith(`${category}`);
      }

      const entries = (entry as { entries: any[] }).entries;

      return {
        ...entry,
        entries: entries.filter((e) => e.href.startsWith(`${category}`)),
      };
    }),
  }))
  .filter((group) => group.entries.length > 0);

let props = Astro.props;

if (
  Astro.props.entry.slug.startsWith('zh-cn/blogs') ||
  Astro.props.entry.slug.startsWith('en/blogs') ||
  Astro.props.entry.slug.startsWith('blogs') ||
  Astro.props.entry.slug.startsWith('zh-cn/meta') ||
  Astro.props.entry.slug.startsWith('en/meta')
) {
  props = Astro.props;
} else {
  props = {
    ...Astro.props,
    sidebar: filteredSidebar,
  };
}
---

<DefaultSidebar {...props} />
